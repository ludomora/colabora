<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        // SEU LINK DO CSV
        const URL_DO_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSvQy4q-OxuAU1qksB7Ibq7tgCXawoOtw0jYsNV3NIru1brGHNmeH32ARzJbccsFhKTOcgca0WZpCGr/pub?output=csv";
        
        // BACKUP DE SEGURAN√áA
        const DADOS_BACKUP = [
            {Dia: "24/02", Hora: "09h √†s 12h30", Atividade: "Reuni√£o de alinhamento da Coordena√ß√£o Nacional", Local: "Interno", Tipo: "Reuni√£o", Observacoes: "Pauta interna."},
            {Dia: "25/02", Hora: "09h √†s 12h30", Atividade: "Plen√°ria de acolhida", Local: "Audit√≥rio", Tipo: "Plen√°ria", Observacoes: ""}
        ];

        let dadosDoEvento = [];

        function carregarDados() {
            // --- O TRUQUE DO AUTO-REFRESH ---
            // Criamos um n√∫mero baseado no hor√°rio atual (milissegundos)
            const timestamp = new Date().getTime();
            // Adicionamos esse n√∫mero ao final do link. O Google ignora, mas o navegador acha que √© um link novo!
            const urlSemCache = URL_DO_CSV + "&t=" + timestamp;

            const indicadorLoading = document.querySelector('.loading');
            if(indicadorLoading) indicadorLoading.innerHTML = "‚è≥ Buscando atualiza√ß√µes...";

            Papa.parse(urlSemCache, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    console.log("Dados atualizados baixados com sucesso!");
                    dadosDoEvento = results.data;
                    
                    // Verifica qual aba est√° ativa para manter o usu√°rio nela
                    const botaoAtivo = document.querySelector('.nav-btn.active');
                    const diaAtivo = botaoAtivo ? botaoAtivo.innerText.includes('24') ? '24/02' : 
                                                  botaoAtivo.innerText.includes('25') ? '25/02' :
                                                  botaoAtivo.innerText.includes('26') ? '26/02' :
                                                  botaoAtivo.innerText.includes('27') ? '27/02' : 'Geral' : 'Geral';
                    
                    filtrarProgramacao(diaAtivo);
                },
                error: function(err) {
                    console.warn("Erro ao buscar dados novos. Usando backup.", err);
                    dadosDoEvento = DADOS_BACKUP;
                    filtrarProgramacao('Geral');
                    document.querySelector('footer p').innerHTML += " <br><span style='color:orange'>(Modo Offline)</span>";
                }
            });
        }

        // Fun√ß√£o de normaliza√ß√£o de texto (slugs)
        function normalizarTipo(tipo) {
            if (!tipo) return "padrao";
            return tipo
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, "")
                .toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '');
        }

        function filtrarProgramacao(diaSelecionado, botaoClicado) {
            const container = document.getElementById('conteudo-programacao');
            
            if(botaoClicado) {
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                botaoClicado.classList.add('active');
            }

            container.innerHTML = "";
            
            const eventosFiltrados = dadosDoEvento.filter(item => {
                if (diaSelecionado === 'Geral') return true; 
                return item.Dia && item.Dia.includes(diaSelecionado);
            });

            if (eventosFiltrados.length === 0) {
                container.innerHTML = "<p style='text-align:center; margin-top:30px; color:#666'>Sem programa√ß√£o para este dia.</p>";
                return;
            }

            eventosFiltrados.forEach(evento => {
                const classeTipo = normalizarTipo(evento.Tipo);
                
                let htmlDetalhes = "";
                if (evento.Observacoes && evento.Observacoes.trim() !== "") {
                    htmlDetalhes = `
                        <details>
                            <summary>Ver detalhes</summary>
                            <div class="detalhes-texto">${evento.Observacoes}</div>
                        </details>
                    `;
                }

                let htmlDia = "";
                if (diaSelecionado === 'Geral') {
                    htmlDia = `<span style="font-size:0.8rem; background:#eee; padding:2px 6px; border-radius:4px; margin-right:5px; color:#333;">üìÖ ${evento.Dia}</span>`;
                }

                const cartao = `
                    <div class="card tipo-${classeTipo}">
                        <div class="card-header">
                            <div>
                                ${htmlDia}
                                <span class="card-time">‚è∞ ${evento.Hora}</span>
                            </div>
                            <span class="card-tag tag-${classeTipo}">${evento.Tipo}</span>
                        </div>
                        <div class="card-body">
                            <h3 style="margin: 0 0 5px 0; color: var(--cor-azul)">${evento.Atividade}</h3>
                            <span class="card-location">üìç ${evento.Local}</span>
                            ${htmlDetalhes}
                        </div>
                    </div>
                `;
                container.innerHTML += cartao;
            });
        }

        // Inicia o carregamento
        carregarDados();

        // Opcional: Verifica se h√° dados novos automaticamente a cada 5 minutos (300000 ms) sem precisar recarregar a p√°gina
        setInterval(carregarDados, 300000);

    </script>
